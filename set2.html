<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Set 2 – Dreamlight Valley Begleiter</title>
  <style>
    /* Linke Seitenleiste */
    .sidebar {
      width: 220px;
      background: rgba(12, 12, 20, 0.95);
      box-shadow: 2px 0 10px rgba(0,0,0,0.4);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px 10px;
      border-right: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar .logo {
      font-size: 1.2rem;
      margin-bottom: 20px;
      color: #bfaeff;
      text-align: center;
    }

    .sidebar nav {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .nav-btn {
      display: block;
      background: none;
      border: none;
      color: #ddd;
      padding: 10px;
      text-align: left;
      width: 100%;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
      text-decoration: none;
      font: inherit;
    }

    .nav-btn:hover:not(.disabled) {
      background: rgba(95,95,217,0.2);
      color: #fff;
    }

    .nav-btn.active {
      background: rgba(95,95,217,0.4);
      color: #fff;
      font-weight: bold;
    }

    .nav-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    body {
      display: flex;
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at center, #0a0a12 0%, #030308 100%);
      color: #eee;
      font-family: 'Audiowide', system-ui, sans-serif;
    }

    /* Der Hauptbereich rechts von der Sidebar */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow-y: auto;
      padding: 20px;
    }

    .userbar {
      display: flex;
      gap: 8px;
      align-items: center;
      background: rgba(10, 10, 20, 0.85);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      box-shadow: 0 0 12px rgba(0,0,0,0.6);
      margin-bottom: 20px;
    }

    .userbar select {
      background: #151522;
      border: 1px solid #444;
      border-radius: 999px;
      padding: 4px 8px;
      color: #eee;
    }

    .userbar button {
      background: #5f5fd9;
      border: none;
      border-radius: 999px;
      padding: 4px 10px;
      color: white;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .userbar button:hover {
      filter: brightness(1.1);
    }

    #status-text {
      margin-left: 6px;
      opacity: 0.8;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 35px;
      text-align: center;
    }

    .card {
      width: 170px;
      border-radius: 14px;
      box-shadow: 0 0 18px rgba(255,255,255,0.05);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      transform: translateY(0px);
      cursor: pointer;
      position: relative;
      overflow: visible;
    }

    .card img {
      width: 100%;
      display: block;
      border-radius: 14px;
      filter: grayscale(1) brightness(0.5);
      opacity: 0.5;
      transition: filter 0.25s ease, opacity 0.25s ease;
    }

    .card::after {
      content: attr(data-count);
      position: absolute;
      right: 6px;
      bottom: 6px;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: rgba(15, 15, 25, 0.95);
      border: 2px solid rgba(255, 255, 255, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', 'Arial', sans-serif;
      font-weight: 600;
      font-size: 0.8rem;
      color: #f8f8ff;
      text-shadow: 0 0 4px rgba(255,255,255,0.5);
      box-shadow: 0 0 6px rgba(255,255,255,0.15);
    }

    .card[data-count="0"]::after,
    .card:not([data-count])::after {
      display: none;
    }

    .card.unlocked img {
      filter: none;
      opacity: 1;
    }

    .card.unlocked:hover {
      transform: translateY(-6px) scale(1.05);
      box-shadow: 0 0 24px rgba(255,255,255,0.15);
    }

    .center-text {
      background: linear-gradient(180deg, #1e1e3a 0%, #12122a 100%);
      border: 2px solid rgba(160,120,255,0.6);
      border-radius: 20px;
      color: #eaeaea;
      width: 170px;
      height: 250px;
      box-shadow: 0 0 25px rgba(150,100,255,0.3), inset 0 0 20px rgba(80,60,150,0.3);
      text-shadow: 0 0 10px rgba(255,255,255,0.2);
      backdrop-filter: blur(4px);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 10px;
      box-sizing: border-box;
    }

    .center-text h2 {
      font-size: 0.9rem;
      line-height: 1.2;
      margin: 0 0 8px 0;
      color: #e9d9ff;
      text-align: center;
    }

    .center-text p {
      font-size: 0.8rem;
      opacity: 0.85;
      margin: 0;
      text-align: center;
      color: #b3aaff;
    }

    .album {
      animation: fadeIn 1s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to   { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>
  <div id="sidebar-container"></div>

  <div class="content">
    <div class="album">

      <div class="userbar">
        <label for="username-select">Benutzer:</label>
        <select id="username-select">
          <!-- wird per JS aus der CSV gefüllt -->
        </select>
        <button id="load-btn">Laden</button>
        <span id="status-text"></span>
      </div>

      <p id="total-pulled" style="margin-top: 30px; font-size: 0.9rem; opacity: 0.85; color: #b3aaff;">
        Insgesamt 0 Karten aus diesem Set gezogen.
      </p>

      <div class="grid">
        <!-- Reihe 1 -->
        <div class="card" data-col="#1_Schnuffi">
          <img src="SpritesSet2DDV/1_Schnuffi.png" alt="Schnuffi">
        </div>

        <div class="card" data-col="#2_Langohr">
          <img src="SpritesSet2DDV/2_Langohr.png" alt="Langohr">
        </div>

        <div class="card" data-col="#3_Shelly">
          <img src="SpritesSet2DDV/3_Shelly.png" alt="Shelly">
        </div>

        <!-- Reihe 2 -->
        <div class="card" data-col="#4_Federwisch">
          <img src="SpritesSet2DDV/4_Federwisch.png" alt="Federwisch">
        </div>

        <div class="center-text">
          <h2>Tzwehns zweites<br>Sammelkarten-BoosterPack</h2>
          <p>Disney Dreamlight Valley – Begleiter</p>
        </div>

        <div class="card" data-col="#5_Knacki">
          <img src="SpritesSet2DDV/5_Knacki.png" alt="Knacki">
        </div>

        <!-- Reihe 3 -->
        <div class="card" data-col="#6_Goldodil">
          <img src="SpritesSet2DDV/6_Goldodil.png" alt="Goldodil">
        </div>

        <div class="card" data-col="#7_Ennui">
          <img src="SpritesSet2DDV/7_Ennui.png" alt="Ennui">
        </div>

        <div class="card" data-col="#8_Feuerjunges">
          <img src="SpritesSet2DDV/8_Feuerjunges.png" alt="Feuerjunges">
        </div>
      </div>
    </div>
  </div>

  <script>
    let csvHeaders = [];
    let csvRows = [];
    let csvSep = ";";

    async function initAlbum() {
      const resp = await fetch("cards_user_summary.csv");
      const text = await resp.text();

      const lines = text.trim().split(/\r?\n/);
      if (lines.length < 2) {
        console.warn("CSV hat keine Daten.");
        return;
      }

      const headerLine = lines[0];
      csvSep = headerLine.includes(";") ? ";" : ",";
      csvHeaders = headerLine.split(csvSep).map(h => h.trim());
      csvRows = lines.slice(1).map(line => line.split(csvSep));

      const usernames = csvRows
        .map(cols => (cols[0] || "").trim())
        .filter(name => name.length > 0);

      const unique = [...new Set(usernames)];
      unique.sort((a, b) => a.localeCompare(b, "de", { sensitivity: "base" }));

      const select = document.getElementById("username-select");
      unique.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });

      const defaultUser = "Tzwehn";
      const def = unique.find(
        n => n.toLowerCase() === defaultUser.toLowerCase()
      );
      if (def) {
        select.value = def;
      }

      updateForCurrentSelection();
    }

    function applyOwnedFromSummary(username) {
      const row = csvRows.find(
        cols => (cols[0] || "").trim().toLowerCase() === username.toLowerCase()
      );

      const allCards = document.querySelectorAll(".card");

      if (!row) {
        console.warn("User nicht gefunden:", username);
        allCards.forEach(card => {
          card.classList.remove("unlocked");
          card.dataset.count = "0";
        });
        return { username, ownedCount: 0, total: allCards.length, totalPulled: 0 };
      }

      const valuesByHeader = {};
      csvHeaders.forEach((h, idx) => {
        valuesByHeader[h] = (row[idx] || "").trim();
      });

      let ownedCount = 0;

      allCards.forEach(card => {
        const col = card.dataset.col;
        const value = valuesByHeader[col];
        const num = parseInt(value, 10) || 0;

        card.dataset.count = String(num);

        if (num > 0) {
          card.classList.add("unlocked");
          ownedCount++;
        } else {
          card.classList.remove("unlocked");
        }
      });

      const totalPulled = Array.from(allCards).reduce((sum, card) => {
        const n = parseInt(card.dataset.count || "0", 10);
        return sum + (isNaN(n) ? 0 : n);
      }, 0);

      return { username, ownedCount, total: allCards.length, totalPulled };
    }

    function updateForCurrentSelection() {
      const select = document.getElementById("username-select");
      const status = document.getElementById("status-text");
      const name = select.value;

      if (!name) {
        status.textContent = "Kein Benutzer ausgewählt.";
        return;
      }

      const result = applyOwnedFromSummary(name);
      status.textContent = `Album für ${result.username}: ${result.ownedCount}/${result.total} Karten`;

      const totalText = document.getElementById("total-pulled");
      if (totalText) {
        totalText.textContent = `Insgesamt ${result.totalPulled} Karten aus diesem Set gezogen.`;
      }
    }

    document.getElementById("load-btn").addEventListener("click", updateForCurrentSelection);
    document.getElementById("username-select").addEventListener("change", updateForCurrentSelection);

   async function loadSidebar() {
  try {
    const resp = await fetch("sidebar.html");
    const html = await resp.text();
    document.getElementById("sidebar-container").innerHTML = html;

    // Aktive Seite: set2.html
    const current = "set2.html";

    document.querySelectorAll(".nav-btn").forEach(btn => {
      const onclick = (btn.getAttribute("onclick") || "").toLowerCase();
      if (onclick.includes(current)) {
        btn.classList.add("active");
      }
    });
  } catch (e) {
    console.error("Sidebar konnte nicht geladen werden:", e);
  }
}

    // Start: CSV & Sidebar laden
    initAlbum().catch(console.error);
    loadSidebar().catch(console.error);
  </script>
</body>
</html>
