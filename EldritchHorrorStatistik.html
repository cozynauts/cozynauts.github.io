<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Eldritch Horror ‚Äì Aktuelle Statistiken</title>
  <style>
    :root {
      --bg: #050510;
      --panel: #141426;
      --panel-soft: #1d1d35;
      --accent: #bfaeff;
      --accent-strong: #f5a623;
      --text: #f5f5ff;
      --muted: #a0a0c0;
      --border-soft: rgba(255,255,255,0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #16162e 0, #050510 55%, #020208 100%);
      color: var(--text);
    }

    .layout {
      display: flex;
      min-height: 100vh;
    }

    /* Linke Sidebar */
    .sidebar {
      width: 220px;
      background: rgba(10,10,25,0.98);
      border-right: 1px solid var(--border-soft);
      box-shadow: 4px 0 20px rgba(0,0,0,0.7);
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar-title {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--accent);
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .nav-item {
      color: var(--muted);
      text-decoration: none;
      font-size: 0.9rem;
      padding: 7px 10px;
      border-radius: 8px;
      transition: 0.2s;
      display: block;
    }

    .nav-item:hover {
      color: var(--text);
      background: rgba(255,255,255,0.09);
    }

    .nav-item.active {
      color: var(--text);
      background: linear-gradient(90deg, #5b4bff, #bfaeff);
      box-shadow: 0 0 14px rgba(191,174,255,0.45);
      font-weight: 600;
    }

    /* Hauptbereich */
    .main {
      flex: 1;
      padding: 24px 24px 32px;
    }

    h1 {
      margin: 0 0 16px;
      font-size: 1.6rem;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin-bottom: 24px;
      color: var(--muted);
      font-size: 0.9rem;
    }

.grid {
  display: grid;
  grid-template-columns: repeat(2, 430px);   /* ‚òÖ exakt 2 Karten nebeneinander */
  gap: 20px;
  justify-content: left;                   /* Grid wird links angebunden */
}



.card {
  width: 400px;                 /* ‚òÖ FIXE Breite */
  background: radial-gradient(circle at top left, #27274a 0, var(--panel) 40%, #0b0b18 100%);
  border-radius: 16px;
  padding: 12px 12px 10px;
  box-shadow:
    0 18px 40px rgba(0,0,0,0.65),
    0 0 0 1px rgba(255,255,255,0.03);
  border: 1px solid var(--border-soft);
  display: flex;
  flex-direction: column;
  height: auto;
}


    .card h2 {
      margin: 0 0 8px;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card h2 span.emoji {
      font-size: 1.1rem;
    }

    .card small {
      color: var(--muted);
      font-size: 0.78rem;
      margin-bottom: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 4px;
    }

    thead {
      background: rgba(255,255,255,0.04);
    }

    th, td {
      padding: 3px 4px;
      text-align: left;
      white-space: nowrap;
    }

    th {
      font-weight: 600;
      font-size: 0.74rem;
      color: var(--muted);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    tbody tr:nth-child(odd) {
      background: rgba(255,255,255,0.02);
    }

    tbody tr:nth-child(even) {
      background: rgba(0,0,0,0.08);
    }

    tbody tr:first-child {
      background: linear-gradient(90deg, rgba(255,215,0,0.18), rgba(0,0,0,0.05));
    }

    td.rank {
      width: 1%;
      text-align: right;
      padding-right: 6px;
      color: var(--muted);
      font-variant-numeric: tabular-nums;
    }

    td.name {
      font-weight: 600;
    }

    td.value-positive {
      color: #8be58b;
      font-variant-numeric: tabular-nums;
    }

    td.value-neutral {
      color: #f5f5ff;
      font-variant-numeric: tabular-nums;
    }

    td.value-bad {
      color: #ff8888;
      font-variant-numeric: tabular-nums;
    }

    .footer-note {
      margin-top: 18px;
      color: var(--muted);
      font-size: 0.78rem;
    }

@media (max-width: 950px) {
  .grid {
    grid-template-columns: 1fr;
  }
  .card {
    width: 100%;        /* Handy: volle Breite */
  }
}


    @media (max-width: 800px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .nav {
        flex-direction: row;
        flex-wrap: wrap;
      }
      .main {
        padding: 16px;
      }
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="sidebar-title">Eldritch Horror</div>
<nav class="nav">
  <a href="EldritchHorrorStatistik.html" class="nav-item">Startseite</a>
  <a href="player_stats.html" class="nav-item">Spielerstatistik</a>
  <a href="character_stats.html" class="nav-item">Charakterstatistik</a>
  <a href="ancient_stats.html" class="nav-item">Gegnerstatistik</a>
  <a href="ranking.html" class="nav-item">Rangliste</a>
  <a href="history.html" class="nav-item">Historie</a>
</nav>

    </aside>

    <main class="main">
      <h1>Aktuelle Statistiken</h1>
      <div class="subtitle">
        Basis: <code>eldritch_games.csv</code> ‚Äì jede Zeile = 1 Spieler in 1 Partie.<br>
        Sieg + nur ein Ermittler = <strong>Unsterblich</strong>. Sieg mit mehreren Ermittlern = alle bis auf den letzten sind gestorben. Niederlage = alle Ermittler gestorben.
      </div>

      <div class="grid">
        <div class="card" id="card-games">
          <h2><span class="emoji">üé≤</span> Spiele</h2>
          <small>Top&nbsp;10 nach gespielten Partien</small>
          <table>
            <thead>
              <tr>
                <th style="width:1%">Platz</th>
                <th>Name</th>
                <th style="text-align:right">Anzahl</th>
              </tr>
            </thead>
            <tbody id="table-games-body"></tbody>
          </table>
        </div>

        <div class="card" id="card-winrate">
          <h2><span class="emoji">üèÜ</span> Siegesquoten</h2>
          <small>Top&nbsp;10 nach Siegquote (min. 2 Spiele)</small>
          <table>
            <thead>
              <tr>
                <th style="width:1%">Platz</th>
                <th>Name</th>
                <th style="text-align:right">Quote</th>
              </tr>
            </thead>
            <tbody id="table-winrate-body"></tbody>
          </table>
        </div>

        <div class="card" id="card-immortal">
          <h2><span class="emoji">‚ú®</span> Unsterblichkeitsquote</h2>
          <small>Top&nbsp;10 nach Anteil Siege mit nur einem Ermittler</small>
          <table>
            <thead>
              <tr>
                <th style="width:1%">Platz</th>
                <th>Name</th>
                <th style="text-align:right">Quote</th>
              </tr>
            </thead>
            <tbody id="table-immortal-body"></tbody>
          </table>
        </div>

        <div class="card" id="card-deaths">
          <h2><span class="emoji">üíÄ</span> Tode pro Spiel</h2>
          <small>Top&nbsp;10 nach durchschnittlichen Toden pro Partie</small>
          <table>
            <thead>
              <tr>
                <th style="width:1%">Platz</th>
                <th>Name</th>
                <th style="text-align:right">Tode/Spiel</th>
              </tr>
            </thead>
            <tbody id="table-deaths-body"></tbody>
          </table>
        </div>
      </div>

      <div class="footer-note">
        CSV-Regel: <code>Investigators</code> trennt Ermittler mit Komma. Die Seite erwartet das Format<br>
        <code>Date;AncientOne;Difficulty;Result;Player;Investigators</code> ‚Äì genau wie deine aktuelle Datei.
      </div>
    </main>
  </div>

  <script>
    function formatPercent(value) {
      if (!isFinite(value) || isNaN(value)) return "0,00%";
      return (value * 100).toFixed(2).replace(".", ",") + "%";
    }

    function formatNumber(value) {
      if (!isFinite(value) || isNaN(value)) return "0,00";
      return Number(value).toFixed(2).replace(".", ",");
    }

    async function loadAndRenderStats() {
      const response = await fetch("eldritch_games.csv");
      if (!response.ok) {
        console.error("Konnte eldritch_games.csv nicht laden", response.status);
        return;
      }
      const text = await response.text();
      const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);

      if (lines.length <= 1) return;

      const header = lines[0].split(";").map(h => h.trim());
      const rows = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;

        const parts = line.split(";");
        if (parts.length < header.length) continue;

        const row = {};
        header.forEach((h, idx) => {
          row[h] = (parts[idx] ?? "").trim();
        });
        rows.push(row);
      }

      const players = {};

      for (const row of rows) {
        const player = row["Player"] || row["Spieler"] || "Unbekannt";
        if (!players[player]) {
          players[player] = { games: 0, wins: 0, deaths: 0, immortals: 0 };
        }
        const stats = players[player];
        stats.games += 1;

        const result = (row["Result"] || "").trim();
        const invRaw = (row["Investigators"] || "").trim();
        const investigators = invRaw
          ? invRaw.split(",").map(s => s.trim()).filter(Boolean)
          : [];
        const n = investigators.length;

        if (result === "Niederlage") {
          stats.deaths += n;
        } else {
          stats.wins += 1;
          if (n === 1) {
            stats.immortals += 1;
          } else if (n > 1) {
            stats.deaths += Math.max(0, n - 1);
          }
        }
      }

      const playerArray = Object.entries(players).map(([name, s]) => {
        const winRate = s.games ? s.wins / s.games : 0;
        const immortalRate = s.games ? s.immortals / s.games : 0;
        const deathsPerGame = s.games ? s.deaths / s.games : 0;
        return { name, ...s, winRate, immortalRate, deathsPerGame };
      });

      renderTable(
        "table-games-body",
        playerArray
          .slice()
          .sort((a, b) => b.games - a.games || a.name.localeCompare(b.name)),
        item => ({
          value: item.games,
          cssClass: "value-neutral"
        })
      );

      renderTable(
        "table-winrate-body",
        playerArray
          .filter(p => p.games >= 2)
          .sort((a, b) => b.winRate - a.winRate || b.games - a.games),
        item => ({
          value: formatPercent(item.winRate),
          cssClass: "value-positive"
        })
      );

      renderTable(
        "table-immortal-body",
        playerArray
          .filter(p => p.games >= 2)
          .sort((a, b) => b.immortalRate - a.immortalRate || b.games - a.games),
        item => ({
          value: formatPercent(item.immortalRate),
          cssClass: item.immortalRate > 0 ? "value-positive" : "value-neutral"
        })
      );

      renderTable(
        "table-deaths-body",
        playerArray
          .filter(p => p.games >= 2)
          .sort((a, b) => b.deathsPerGame - a.deathsPerGame || b.games - a.games),
        item => ({
          value: formatNumber(item.deathsPerGame),
          cssClass:
            item.deathsPerGame > 1
              ? "value-bad"
              : item.deathsPerGame > 0.5
              ? "value-neutral"
              : "value-positive"
        })
      );
    }

    function renderTable(tbodyId, data, valueMapper) {
      const tbody = document.getElementById(tbodyId);
      tbody.innerHTML = "";

      const top = data.slice(0, 10);

      top.forEach((item, index) => {
        const tr = document.createElement("tr");

        const tdRank = document.createElement("td");
        tdRank.className = "rank";
        tdRank.textContent = index + 1;
        tr.appendChild(tdRank);

        const tdName = document.createElement("td");
        tdName.className = "name";
        tdName.textContent = item.name;
        tr.appendChild(tdName);

        const { value, cssClass } = valueMapper(item);
        const tdVal = document.createElement("td");
        tdVal.style.textAlign = "right";
        tdVal.className = cssClass;
        tdVal.textContent = value;
        tr.appendChild(tdVal);

        tbody.appendChild(tr);
      });
    }

    loadAndRenderStats().catch(err => console.error(err));
  </script>
  <script>
  // Aktive Seite anhand der URL hervorheben
  const currentPage = window.location.pathname.split("/").pop() || "EldritchHorrorStatistik.html";
  document.querySelectorAll(".nav-item").forEach(link => {
    const href = link.getAttribute("href");
    if (href === currentPage) {
      link.classList.add("active");
    }
  });
</script>

</body>
</html>
