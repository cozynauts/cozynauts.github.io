<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>Samendeck ‚Äì Gartenspiel (Singleplayer)</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #050510;
      color: #f5f5ff;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 270px;
      background: rgba(15, 15, 30, 0.97);
      padding: 20px;
      box-shadow: 2px 0 12px rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .sidebar h1 {
      font-size: 1.4rem;
      margin: 0 0 4px;
      color: #d7c2ff;
    }
    .sidebar h2 {
      font-size: 0.95rem;
      margin: 10px 0 4px;
      color: #a9a3ff;
    }
    .stat {
      margin: 0;
      font-size: 0.9rem;
    }
    .stat small {
      opacity: 0.7;
      font-size: 0.75rem;
    }
    .buttons {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    button {
      padding: 7px 12px;
      border-radius: 999px;
      border: none;
      background: #7b5dff;
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.85rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    button.secondary {
      background: rgba(255,255,255,0.08);
      color: #f5f5ff;
      font-weight: 500;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
      box-shadow: none;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      gap: 16px;
    }
    .main h2 {
      margin: 0 0 4px;
      font-size: 1.05rem;
    }
    .zone {
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: radial-gradient(circle at top left, rgba(124,96,255,0.14), rgba(0,0,0,0.4));
      padding: 10px;
      min-height: 110px;
    }
    #hand, #played {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

        .zone-boards {
      display: flex;
      gap: 10px;
      align-items: stretch;
    }
    .board {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .board-field { flex: 4; }
    .board-companions { flex: 2; }
    .board-weather { flex: 1; }

    #field, #companions, #weather {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .plant-card {
      width: 130px;
      padding: 6px;
      border-radius: 10px;
      background: rgba(10, 18, 30, 0.95);
      border: 1px solid rgba(255,255,255,0.18);
      font-size: 0.72rem;
      line-height: 1.2;
    }
    .plant-card-title {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .plant-card-meta {
      font-size: 0.7rem;
      opacity: 0.8;
    }


    .card {
      width: 140px;
      padding: 8px;
      border-radius: 12px;
      background: rgba(20, 18, 40, 0.95);
      border: 1px solid rgba(255,255,255,0.18);
      cursor: pointer;
      font-size: 0.78rem;
      line-height: 1.2;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }
    .card-title {
      font-weight: 600;
    }
    .card-tag {
      font-size: 0.7rem;
      opacity: 0.7;
    }
    .card-type {
      font-size: 0.72rem;
      opacity: 0.75;
    }
    .card-desc {
      font-size: 0.72rem;
      opacity: 0.9;
    }

    .card.seed { border-left: 4px solid #8be38b; }
    .card.fertilizer { border-left: 4px solid #f5e38b; }
    .card.weather { border-left: 4px solid #8bd3f5; }
    .card.companion { border-left: 4px solid #f58bd6; }
    .card.tool { border-left: 4px solid #f59e8b; }

    .card.disabled {
      opacity: 0.45;
      cursor: default;
    }

    #log {
      flex: 1;
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: radial-gradient(circle at top right, rgba(255,255,255,0.04), rgba(0,0,0,0.5));
      font-size: 0.8rem;
      overflow-y: auto;
      max-height: 200px;
    }
    #log p {
      margin: 2px 0;
    }

        .help-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none; /* wird per JS auf "flex" gesetzt */
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .help-content {
      max-width: 640px;
      max-height: 80vh;
      overflow-y: auto;
      background: #121225;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.2);
      padding: 20px 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      font-size: 0.9rem;
    }
    .help-content h2 {
      margin-top: 0;
      margin-bottom: 8px;
      color: #d7c2ff;
    }
    .help-content h3 {
      margin-bottom: 4px;
      margin-top: 12px;
      font-size: 0.95rem;
      color: #cfd4ff;
    }
    .help-content p {
      margin: 4px 0 8px;
    }
    .help-content ul {
      margin: 4px 0 8px 18px;
      padding: 0;
    }
    .help-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      gap: 12px;
      flex-wrap: wrap;
      font-size: 0.8rem;
      opacity: 0.9;
    }
    .link-btn {
      text-decoration: none;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.3);
      font-size: 0.8rem;
      color: #f5f5ff;
      display: inline-block;
    }

  </style>
</head>
<body>
  <aside class="sidebar">
    <h1>Samendeck</h1>
    <p class="stat">Runde: <span id="round">1</span> / <span id="maxRounds">10</span></p>
    <p class="stat">Punkte: <span id="score">0</span></p>
    <p class="stat">Highscore: <span id="bestScore">0</span></p>
    <p class="stat">Deck: <span id="deckSize">0</span> Karten</p>
    <p class="stat">Ablage: <span id="discardSize">0</span> Karten</p>
    <p class="stat">Z√ºge in dieser Runde: <span id="playsLeft">2</span> / <span id="maxPlays">2</span></p>

    <h2>Aktionen</h2>
    <div class="buttons">
      <button id="endTurnBtn">Runde beenden</button>
      <button id="restartBtn" class="secondary">Neues Spiel</button>
      <button id="helpBtn" class="secondary">üìñ Hilfe</button>
      <button class="secondary" onclick="window.open('kartendex.html','_blank')">üìö Kartendex</button>
    </div>
    <p class="stat"><small>Klicke Karten in deiner Hand, um sie auszuspielen. Synergien bringen viele Punkte üå±</small></p>
  </aside>

  <main class="main">
    <section>
      <h2>Hand</h2>
      <div class="zone">
        <div id="hand"></div>
      </div>
    </section>

    <section>
      <h2>In dieser Runde gespielt</h2>
      <div class="zone">
        <div id="played"></div>
      </div>
    </section>

<section>
  <h2>Feld, Begleiter & Wetter</h2>
  <div class="zone zone-boards">
    <div class="board board-field">
      <h3 style="margin:0 0 4px;font-size:0.9rem;">Feld</h3>
      <div id="field"></div>
    </div>
    <div class="board board-companions">
      <h3 style="margin:0 0 4px;font-size:0.9rem;">Aktive Begleiter</h3>
      <div id="companions"></div>
    </div>
    <div class="board board-weather">
      <h3 style="margin:0 0 4px;font-size:0.9rem;">Wetter</h3>
      <div id="weather"></div>
    </div>
  </div>
</section>

    
    <section>
      <h2>Log</h2>
      <div id="log"></div>
    </section>
  </main>

    <!-- Hilfe-Overlay -->
  <div id="helpOverlay" class="help-overlay">
    <div class="help-content">
      <h2>Wie funktioniert Samendeck?</h2>
      <p>
        Du spielst in <strong>10 Runden</strong> mit jeweils
        <strong>3 Z√ºgen</strong>. In jedem Zug spielst du eine Karte aus
        deiner Hand, um Punkte zu sammeln oder deine zuk√ºnftigen Z√ºge zu
        verst√§rken.
      </p>

      <h3>Kurz√ºberblick √ºber die Karten</h3>
      <ul>
        <li><strong>Samen</strong> üå± ‚Äì bringen direkte Punkte.</li>
        <li><strong>D√ºnger</strong> üí© ‚Äì verst√§rkt den zuletzt gespielten Samen.</li>
        <li><strong>Wetter</strong> üå§Ô∏è ‚Äì verbessert zuk√ºnftige Samen in dieser Runde.</li>
        <li><strong>Begleiter</strong> üê∂üßô ‚Äì geben dauerhafte Boni und bleiben aktiv.</li>
        <li><strong>Werkzeuge</strong> ‚öíÔ∏è ‚Äì einmalige Spezialeffekte (z. B. Karten nachziehen).</li>
      </ul>

      <h3>Ziel</h3>
      <p>
        Versuche, am Ende von Runde 10 m√∂glichst viele Punkte zu haben.
        Clevere Kombinationen aus Samen, D√ºnger, Wetter und Begleitern
        bringen besonders hohe Werte.
      </p>

      <div class="help-footer">
        <a href="hilfe.html" target="_blank" class="link-btn">
          Ausf√ºhrliche Anleitung in neuem Tab √∂ffnen
        </a>
        <button id="closeHelpBtn" class="secondary">Schlie√üen</button>
      </div>
    </div>
  </div>

  <script>
    // --- Kartendaten -------------------------------------------------

    const ALL_CARDS = [
      // Samen
// Samen (neues Design)
{
  id: "seed_carrot",
  name: "ü•ï Karotte",
  type: "seed",
  tag: "Gem√ºse",
  growthTime: 2,
  harvestType: "einmalig",
  powerCurve: [1, 3, 5],
  description: "Einsteigerpflanze. Nach 2 Pflegeaktionen erntbar (+5 Power oder +1 Siegpunkt).",
  synergy: "Profitierst von Ernteboni (Markttag, D√ºnger)."
},
{
  id: "seed_strawberry",
  name: "üçì Erdbeere",
  type: "seed",
  tag: "Frucht",
  growthTime: 1,
  harvestType: "einmalig",
  powerCurve: [2, 4],
  description: "Schnelle Punktequelle. Bei Sonne +2 zus√§tzliche Power.",
  synergy: "Stark mit Sonnentag und D√ºnger."
},
{
  id: "seed_tomato",
  name: "üçÖ Tomate",
  type: "seed",
  tag: "Gem√ºse",
  growthTime: 2,
  harvestType: "wiederholbar",
  powerCurve: [1, 3, 4],
  description: "Erntbar alle 2 Runden nach Reife, bleibt aktiv.",
  synergy: "Synergiert mit Gie√ükanne und Energie-Karten."
},
{
  id: "seed_apple",
  name: "üçé Apfelbaum",
  type: "seed",
  tag: "Baum",
  growthTime: 3,
  harvestType: "dauerhaft",
  powerCurve: [1, 2, 3, 5],
  description: "Langfristiger Ertrag. Ab Reife jede Runde +1 Power.",
  synergy: "Profitiert von Hacke und Garten der Ruhe."
},


      // D√ºnger
      {
        id: "fert_compost",
        name: "Kompost",
        type: "fertilizer",
        tag: "Basis",
        description: "Verdoppelt die Punkte des zuletzt gespielten Samens."
      },
      {
        id: "fert_super",
        name: "Superd√ºnger",
        type: "fertilizer",
        tag: "Stark",
        description: "1.5x Punkte des letzten Samens (aufgerundet) + evtl. Begleiterbonus."
      },

      // Wetter
      {
        id: "weather_sun",
        name: "Sonnenschein",
        type: "weather",
        tag: "Wetter",
        description: "+1 Punkt f√ºr alle weiteren Samen in dieser Runde."
      },
      {
        id: "weather_rain",
        name: "Sommerregen",
        type: "weather",
        tag: "Wetter",
        description: "+2 Punkte sofort, +1 Punkt f√ºr alle weiteren Samen in dieser Runde."
      },

      // Begleiter
      {
        id: "comp_milo",
        name: "Milo, Gartenschn√ºffler",
        type: "companion",
        tag: "Hund",
        description: "+2 Punkte jedes Mal, wenn du einen Samen spielst (dauerhaft)."
      },
      {
        id: "comp_gnome",
        name: "Gartenwichtel",
        type: "companion",
        tag: "Wichtel",
        description: "+1 Punkt jedes Mal, wenn du D√ºnger spielst (dauerhaft)."
      },

      // Werkzeuge
      {
        id: "tool_watering",
        name: "Gie√ükanne",
        type: "tool",
        tag: "Werkzeug",
        description: "Wiederholt den letzten D√ºngereffekt, falls vorhanden."
      },
      {
        id: "tool_rake",
        name: "Rechen",
        type: "tool",
        tag: "Werkzeug",
        description: "Ziehe sofort 2 zus√§tzliche Karten."
      }
    ];

    // --- Spielzustand ------------------------------------------------

const state = {
  round: 1,
  maxRounds: 7,
  score: 0,
  deck: [],
  hand: [],
  discard: [],
  playedThisRound: [],
  maxPlaysPerRound: 2,
  playsLeftThisRound: 2,
  lastSeedPoints: 0,
  lastFertilizerBonus: 0,
  weatherSeedBonusThisRound: 0,
  companionSeedBonus: 0,
  companionFertilizerBonus: 0,
  gameOver: false,
  activeCompanions: [],
  activePlants: [],
  activeWeather: null 
};


    // --- Helfer ------------------------------------------------------

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function cloneCard(card) {
      return JSON.parse(JSON.stringify(card));
    }

   function log(message) {
  const logDiv = document.getElementById("log");
  const p = document.createElement("p");
  p.textContent = message;

  // Neueste Nachricht nach oben
  if (logDiv.firstChild) {
    logDiv.insertBefore(p, logDiv.firstChild);
  } else {
    logDiv.appendChild(p);
  }
}

    function drawToHand(targetSize) {
      while (state.hand.length < targetSize) {
        if (state.deck.length === 0) {
          if (state.discard.length === 0) break;
          // Ablagestapel neu mischen
          state.deck = shuffle(state.discard);
          state.discard = [];
          log("Deck gemischt ‚Äì der Ablagestapel wird zum neuen Deck.");
        }
        state.hand.push(state.deck.pop());
      }
    }

    function updateHighscoreIfNeeded() {
      const best = parseInt(localStorage.getItem("samendeck_best") || "0", 10);
      if (state.score > best) {
        localStorage.setItem("samendeck_best", String(state.score));
        log(`üéâ Neuer Highscore! (alter Rekord: ${best} Punkte)`);
      }
    }

    // --- Karten spielen ----------------------------------------------

    function playCard(cardIndex) {
      if (state.gameOver) return;
      if (state.playsLeftThisRound <= 0) {
        log("Du hast in dieser Runde keine Z√ºge mehr √ºbrig.");
        return;
      }

      const card = state.hand[cardIndex];
      if (!card) return;

      state.hand.splice(cardIndex, 1);
      state.playedThisRound.push(card);
      state.playsLeftThisRound--;

      switch (card.type) {
        case "seed":
          handleSeed(card);
          break;
        case "fertilizer":
          handleFertilizer(card);
          break;
        case "weather":
          handleWeather(card);
          break;
        case "companion":
          handleCompanion(card);
          break;
        case "tool":
          handleTool(card);
          break;
      }

      render();
    }

function handleSeed(card) {
  // Neue Samen werden nicht sofort gewertet, sondern in den Garten gesetzt
  card.growth = 0; // bisher absolvierte Pflegeaktionen / Runden
  state.activePlants.push(card);

  log(`üå± ${card.name} wurde gepflanzt (Wachstumszeit: ${card.growthTime} Pflegeaktionen).`);
}


function handleFertilizer(card) {
  if (state.activePlants.length === 0) {
    log(`üí© ${card.name} hat keinen Effekt ‚Äì es ist noch keine Pflanze im Garten.`);
    return;
  }

  // Wir d√ºngen immer die zuletzt gepflanzte Pflanze
  const plant = state.activePlants[state.activePlants.length - 1];

  let steps = 1;
  if (card.id === "fert_super") {
    steps = 2;
  }

  // Gartenwichtel gibt Bonus-Wachstum auf D√ºnger
  steps += state.companionFertilizerBonus;

  plant.growth += steps;

  log(`üí© ${card.name} d√ºngt ${plant.name} ‚Üí Wachstum +${steps} (aktueller Fortschritt: ${plant.growth}/${plant.growthTime}).`);
}


function handleWeather(card) {
  // Falls bereits Wetter aktiv ist, wird es ersetzt
  if (state.activeWeather) {
    log(`üå¶Ô∏è Das bisherige Wetter (${state.activeWeather.name}) endet.`);
  }

  state.activeWeather = card;

  if (card.id === "weather_sun") {
    state.weatherSeedBonusThisRound = 1;
    log("‚òÄÔ∏è Neues Wetter: Sonnenschein ‚Üí zuk√ºnftige Samen erhalten +1 Punkt.");
  } else if (card.id === "weather_rain") {
    state.weatherSeedBonusThisRound = 1;
    state.score += 2;
    log("üåßÔ∏è Neues Wetter: Sommerregen ‚Üí +2 Punkte sofort, zuk√ºnftige Samen erhalten +1 Punkt.");
  } else {
    log(`üå§Ô∏è Wettereffekt aktiviert: ${card.name}`);
  }
}


function handleCompanion(card) {
  // Karte in die Liste der aktiven Begleiter aufnehmen (ohne Duplikate)
  if (!state.activeCompanions.some(c => c.id === card.id)) {
    state.activeCompanions.push(card);
  }

  if (card.id === "comp_milo") {
    state.companionSeedBonus += 2;
    log("üê∂ Milo hilft ab jetzt: +2 Punkte auf jeden zuk√ºnftigen Samen.");
  } else if (card.id === "comp_gnome") {
    state.companionFertilizerBonus += 1;
    log("üßô Gartenwichtel aktiv: +1 Punkt auf jeden zuk√ºnftigen D√ºnger.");
  } else {
    log(`Begleiter gespielt: ${card.name}.`);
  }
}

    function handleTool(card) {
      if (card.id === "tool_watering") {
        if (state.lastFertilizerBonus > 0) {
          state.score += state.lastFertilizerBonus;
          log(`‚öíÔ∏è Gie√ükanne: D√ºngereffekt wiederholt ‚Üí +${state.lastFertilizerBonus} Punkte.`);
        } else {
          log("‚öíÔ∏è Gie√ükanne: Kein D√ºngerbonus vorhanden ‚Äì kein Effekt.");
        }
      } else if (card.id === "tool_rake") {
        drawToHand(state.hand.length + 2);
        log("üßπ Rechen: Du ziehst 2 zus√§tzliche Karten.");
      } else {
        log(`Werkzeug gespielt: ${card.name}.`);
      }
    }

// --- Rundenlogik -------------------------------------------------

function endTurn() {
  if (state.gameOver) return;

// üåø 1. Wachstum & Erntephase f√ºr alle aktiven Pflanzen
state.activePlants.forEach(p => {
  // jede Runde +1 Wachstum
  p.growth++;

  if (p.growth >= p.growthTime) {
    // Reife erreicht ‚Üí ‚ÄûEndwert‚Äú der Pflanze
    const matureIndex = p.powerCurve.length - 1;
    const plantBase = p.powerCurve[matureIndex];

    const miloBonus = state.companionSeedBonus; // pro Ernte
    const totalGain = plantBase + miloBonus;

    state.score += totalGain;
    state.lastSeedPoints = totalGain;

    // Text-Bausteine f√ºr die Erkl√§rung
    const parts = [`${plantBase} Erntepunkte`];
    if (miloBonus > 0) {
      parts.push(`${miloBonus} Begleiterbonus Milo`);
    }
    const detail = parts.join(" + ");

    log(`üåø ${p.name} wurde geerntet (${detail} = +${totalGain} Punkte).`);

    if (p.harvestType === "einmalig") {
      p.toRemove = true;
      log(`ü•ï ${p.name} wurde entfernt (einmalige Ernte).`);
    } else if (p.harvestType === "wiederholbar") {
      // Pflanze bleibt, beginnt neuen Wachstumszyklus
      p.growth = 0;
      log(`üçÖ ${p.name} w√§chst weiter und kann erneut geerntet werden.`);
    } else if (p.harvestType === "dauerhaft") {
      // bleibt dauerhaft, bringt zus√§tzlich jede Runde +1
      state.score += 1;
      log(`üçé ${p.name} tr√§gt weiter Fr√ºchte (+1 Dauerbonuspunkt).`);
    }
  }
});


  // Entferne abgeerntete Pflanzen
  state.activePlants = state.activePlants.filter(p => !p.toRemove);

// üåæ 2. Gespielte Karten dieser Runde in Ablage
state.discard.push(...state.playedThisRound);
state.playedThisRound = [];
state.lastFertilizerBonus = 0;
state.playsLeftThisRound = state.maxPlaysPerRound;

// Wetter bleibt bestehen, wenn aktiv
if (state.activeWeather) {
  if (state.activeWeather.id === "weather_sun" || state.activeWeather.id === "weather_rain") {
    state.weatherSeedBonusThisRound = 1;
  }
} else {
  state.weatherSeedBonusThisRound = 0;
}

  // üåü 3. Pr√ºfen, ob das Spiel vorbei ist (nach Ernte!)
  if (state.round >= state.maxRounds) {
    state.gameOver = true;
    render();
    log(`‚≠ê Spielende! Du hast insgesamt ${state.score} Punkte erreicht.`);
    updateHighscoreIfNeeded();
    document.getElementById("endTurnBtn").disabled = true;
    return;
  }

  // üå± 4. Neue Runde vorbereiten
  state.round += 1;
  drawToHand(state.hand.length + 1);   // üëà genau 1 Karte nachziehen
  render();
  log(`‚Äî Runde ${state.round} startet. ‚Äî`);
}

    // --- Rendering ---------------------------------------------------

  function render() {
  document.getElementById("round").textContent = state.round;
  document.getElementById("maxRounds").textContent = state.maxRounds;
  document.getElementById("score").textContent = state.score;
  document.getElementById("deckSize").textContent = state.deck.length;
  document.getElementById("discardSize").textContent = state.discard.length;
  document.getElementById("playsLeft").textContent = state.playsLeftThisRound;
  document.getElementById("maxPlays").textContent = state.maxPlaysPerRound;

  const best = parseInt(localStorage.getItem("samendeck_best") || "0", 10);
  document.getElementById("bestScore").textContent = best;

  const handDiv = document.getElementById("hand");
  const playedDiv = document.getElementById("played");
  const companionsDiv = document.getElementById("companions");
  const fieldDiv = document.getElementById("field");
  const weatherDiv = document.getElementById("weather");

  handDiv.innerHTML = "";
  playedDiv.innerHTML = "";
  if (companionsDiv) companionsDiv.innerHTML = "";
  if (fieldDiv) fieldDiv.innerHTML = "";
  if (weatherDiv) weatherDiv.innerHTML = "";

  // Hand rendern
  state.hand.forEach((card, index) => {
    const div = document.createElement("div");
    div.className =
      "card " +
      card.type +
      (state.playsLeftThisRound <= 0 || state.gameOver ? " disabled" : "");

    const typeLabel = {
      seed: "Samen",
      fertilizer: "D√ºnger",
      weather: "Wetter",
      companion: "Begleiter",
      tool: "Werkzeug",
    }[card.type] || card.type;

    div.innerHTML = `
      <div class="card-header">
        <span class="card-title">${card.name}</span>
        <span class="card-tag">${card.tag || ""}</span>
      </div>
      <div class="card-type">${typeLabel}</div>
      <div class="card-desc">${card.description}</div>
    `;

    if (!state.gameOver && state.playsLeftThisRound > 0) {
      div.addEventListener("click", () => playCard(index));
    }
    handDiv.appendChild(div);
  });

  // Diese Runde gespielte Karten
  state.playedThisRound.forEach((card) => {
    const div = document.createElement("div");
    div.className = "card " + card.type + " disabled";

    const typeLabel = {
      seed: "Samen",
      fertilizer: "D√ºnger",
      weather: "Wetter",
      companion: "Begleiter",
      tool: "Werkzeug",
    }[card.type] || card.type;

    div.innerHTML = `
      <div class="card-header">
        <span class="card-title">${card.name}</span>
        <span class="card-tag">${card.tag || ""}</span>
      </div>
      <div class="card-type">${typeLabel}</div>
      <div class="card-desc">${card.description}</div>
    `;
    playedDiv.appendChild(div);
  });

  // Aktive Begleiter & dauerhafte Effekte
  if (companionsDiv) {
    state.activeCompanions.forEach((card) => {
      const div = document.createElement("div");
      div.className = "card " + card.type + " disabled";

      let effectText = card.description;
      if (card.id === "comp_milo") {
        effectText += ` (aktuell +${state.companionSeedBonus} auf Samen)`;
      } else if (card.id === "comp_gnome") {
        effectText += ` (aktuell +${state.companionFertilizerBonus} auf D√ºnger)`;
      }

      div.innerHTML = `
        <div class="card-header">
          <span class="card-title">${card.name}</span>
          <span class="card-tag">${card.tag || ""}</span>
        </div>
        <div class="card-type">Begleiter</div>
        <div class="card-desc">${effectText}</div>
      `;
      companionsDiv.appendChild(div);
    });
  }

  // Feld / aktive Pflanzen
  if (fieldDiv) {
    if (state.activePlants.length === 0) {
      const info = document.createElement("p");
      info.style.fontSize = "0.75rem";
      info.style.opacity = "0.8";
      info.textContent = "Noch keine Pflanzen gesetzt.";
      fieldDiv.appendChild(info);
    } else {
      state.activePlants.forEach((plant) => {
        const div = document.createElement("div");
        div.className = "plant-card";

        const progress = `${Math.min(
          plant.growth || 0,
          plant.growthTime
        )}/${plant.growthTime}`;

        let harvestLabel = "";
        if (plant.harvestType === "einmalig") harvestLabel = "Einmalige Ernte";
        else if (plant.harvestType === "wiederholbar") harvestLabel = "Wiederholbar";
        else if (plant.harvestType === "dauerhaft") harvestLabel = "Dauerhaft";

        div.innerHTML = `
          <div class="plant-card-title">${plant.name}</div>
          <div class="plant-card-meta">Fortschritt: ${progress}</div>
          <div class="plant-card-meta">${harvestLabel}</div>
        `;

        fieldDiv.appendChild(div);
      });
    }
  }

// Wetter-Anzeige
if (weatherDiv) {
  const p = document.createElement("p");
  p.style.fontSize = "0.75rem";
  p.style.opacity = "0.85";

  if (state.activeWeather) {
    p.textContent = `Aktives Wetter: ${state.activeWeather.name} (+${state.weatherSeedBonusThisRound} Samenbonus pro Runde).`;
  } else {
    p.textContent = "Kein aktives Wetter.";
  }

  weatherDiv.appendChild(p);
}


    // --- Init --------------------------------------------------------

function initGame() {
  state.round = 1;
  state.score = 0;
  state.discard = [];
  state.hand = [];
  state.playedThisRound = [];
  state.maxPlaysPerRound = 2;            // üëà explizit
  state.playsLeftThisRound = state.maxPlaysPerRound;
  state.lastSeedPoints = 0;
  state.lastFertilizerBonus = 0;
  state.weatherSeedBonusThisRound = 0;
  state.companionSeedBonus = 0;
  state.companionFertilizerBonus = 0;
  state.gameOver = false;
  state.activeCompanions = [];
  state.activePlants = [];

  // Deck bauen ‚Ä¶
  const deck = [];
  ALL_CARDS.forEach(card => {
    let copies = 2;
    if (card.type === "companion" || card.type === "tool" || card.type === "weather") {
      copies = 1;
    }
    for (let i = 0; i < copies; i++) {
      deck.push(cloneCard(card));
    }
  });

  state.deck = shuffle(deck);
  drawToHand(7);              // üëà Start: 7 Karten
  render();

  document.getElementById("endTurnBtn").disabled = false;

  const logDiv = document.getElementById("log");
  logDiv.innerHTML = "";
  log("Neues Spiel gestartet. Versuche in 10 Runden so viele Punkte wie m√∂glich zu sammeln!");
}


document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("endTurnBtn").addEventListener("click", endTurn);
  document.getElementById("restartBtn").addEventListener("click", initGame);

  const helpBtn = document.getElementById("helpBtn");
  const helpOverlay = document.getElementById("helpOverlay");
  const closeHelpBtn = document.getElementById("closeHelpBtn");

  if (helpBtn && helpOverlay && closeHelpBtn) {
    helpBtn.addEventListener("click", () => {
      helpOverlay.style.display = "flex"; // zentriert die Box
    });

    closeHelpBtn.addEventListener("click", () => {
      helpOverlay.style.display = "none";
    });

    // Klick auf den dunklen Hintergrund schlie√üt ebenfalls
    helpOverlay.addEventListener("click", (e) => {
      if (e.target === helpOverlay) {
        helpOverlay.style.display = "none";
      }
    });
  }

  initGame();
});

  </script>
</body>
</html>
